##### 2.1.5 内部接口

在微服务的实践中，我们可能会遇到下面的安全需求——**有些接口只给内部服务调用，而不应该被外部用户访问**

为达到这个目标，有几种实践方案：

###### 添加认证机制

这些接口虽然是暴漏的，在调用时必须带上特定标识，只允许认证通过的服务访问。这里特定的标识，是管理人员自己设置的一个Token，普通用户不知道。

###### 网关控制访问路径

由于外部用户**能且仅能通过网关来访问微服务**，我们可以直接在网关层面屏蔽掉这些接口。例如，暴漏给用户的接口是public前缀的，而内部接口是internal前缀的

```yml
spring:
  cloud:
    gateway:
      routes:
        - id: user-service
          uri: lb://user-service
          predicates:
            - Path=/user/public/**   # 只暴露 /public 接口
```

这样用户请求`/user/internal/**`时，由于它不符合任何的路由规则，该请求根本不会被转发到后面的微服务。内部的微服务位于同一局域网内，它们之间可以相互调用且不直接对外暴漏。

###### RPC调用

RPC是通过网络调用远程系统（通常是另一台计算机）上的函数或过程，就像调用本地函数一样。RPC不会向外暴漏HTTP接口，其具体的实现方式一般如下：

- a-api抽象出接口
- service-a实现a-api中的接口（@DubboService），并在启动后将自身信息注册到注册中心
- service-b引用a-api中的接口（@DubboReference），虽然不去实现这些接口，但可以直接调用

由于在实践中，微服务（service-a，service-b）不直接对外暴漏，且这些微服务位于同一局域网下，所以可以确保内部相互调用而用户无法访问